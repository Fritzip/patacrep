{% extends "patacrep/base_template.html" %}
{% load static %}

{% block pagetitle %}
<span>{{ chord.title }}</span>
<button type="button" class="btn btn-sm btn-outline-light shadow-none">
  {{ chord.artist }}
</button>
{% endblock %}

{% block buttons %}
    <a role="button" class="btn btn-primary" href="{% url 'patacrep:detail' chord.id %}"><i class="fas fa-eye"></i></a>
    <button type="button" class="btn btn-primary" id="save"><i class="fas fa-save"></i></button>
    <!-- <a class="btn btn-primary" href="{% url 'patacrep:index' %}" id="save_edit" chord_pk="{{chord.pk}}">save & quit</a> -->
    <!-- <a class="btn btn-primary" href="{% url 'patacrep:index' %}">cancel</a> -->
    <!-- <a class="btn btn-primary" id="save_and_next" chord_pk="{{chord.pk}}">save & next</a> -->
{% endblock %}

{% block content %}
<!-- {% autoescape off %} -->
<!-- <span> -->
  <div id="edit-chord-container" class="list-group">
      {% for line in modified_lines %}
        <button type="button" id="{{ line.0 }}" class="del-line list-group-item py-0 border-0 {% if line.2 %}list-group-item-danger{% elif line.3 %}list-group-item-warning{% endif %} text-left"> {{ line.1 }}</button>
      {% endfor %}
  </div>

<!-- </span> -->
<!-- {% endautoescape %} -->

{% endblock %}


{% block js %}
{{ block.super }}
  <script>
    $(document).ready(function() {
      $('.del-line').click(function(e){
        e.target.classList.toggle("list-group-item-danger");
      });

      $('#save').click(function() {
        console.log("save");
        var rm_lines_id_array = []
        $('.list-group-item-danger').each(function() {
          rm_lines_id_array.push($(this).attr('id'));
        });
        $.ajax({
          url: '{% url "patacrep:ajax_save_edit" %}',
          type: "POST",
          data: {
            'rm_lines': rm_lines_id_array,
            'chord_pk': '{{ chord.pk }}',
            csrfmiddlewaretoken: '{{ csrf_token }}',
          },
          dataType: 'json',
          success: function (data) {
            // console.log(data.pkid);
            window.location.href = '{% url "patacrep:confirm_remove" 0 %}'.replace('0', data.pkid);
            // location.href = "http://www.example.com/ThankYou.html"; 
            // if (data.is_taken) {
            //   alert("Successfully modified : " + data.pkid);
            // }
          }
        });
      });
    });
  </script>
  <script>
    $("#save_and_next").click(function () {
      var chord_pk = $(this).attr("chord_pk");
      var modified_content = "" ;
      $( ".del-line" ).each(function( index, e ) {
        if (!$( e ).hasClass("list-group-item-danger") ) {
          modified_content = modified_content.concat($(e).text(), '\n');
        }
      });
      $.ajax({
        url: '{% url "patacrep:save_and_next" %}',
        type: "GET",
        data: {
          'modified_content': modified_content,
          'chord_pk': chord_pk
        },
        dataType: 'json',
        success: function (data) {
          // console.log(data.pkid);
          window.location.href = '{% url "patacrep:confirm_remove" 0 %}'.replace('0', data.pkid);
          // location.href = "http://www.example.com/ThankYou.html"; 
          // if (data.is_taken) {
          //   alert("Successfully modified : " + data.pkid);
          // }
        }
      });
    });
  </script>

{% endblock %}